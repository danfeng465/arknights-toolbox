(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.depot"],{"00d5":function(e,t,r){},"2f6b":function(e,t,r){"use strict";r("8293")},"7e19":function(e,t,r){e.exports=r.p+"assets/pkg/item.a822d699.zip"},8293:function(e,t,r){},8679:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("img",{staticClass:"arkn-item mdui-m-r-1 no-sl no-pe",style:{width:e.widthCss,height:e.widthCss},attrs:{src:e.$root.materialImage(e.img),crossorigin:"anonymous"},on:{error:e.handleImgErr}})},a=[],i=(r("a9e3"),{name:"arkn-item",props:{img:String,width:{type:[Number,String],default:48}},computed:{widthCss:function(){return"number"===typeof this.width?"".concat(this.width,"px"):this.width}},methods:{handleImgErr:function(e){e.target.src=this.$root.avatar("no_image"),e.target.style.backgroundColor="#bdbdbd",e.target.style.borderRadius="50%"}}}),s=i,u=(r("2f6b"),r("0c7c")),c=Object(u["a"])(s,n,a,!1,null,"d0f648b6",null);t["a"]=c.exports},a3d0:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"arkn-depot"}},[e.drImg.src?[r("div",{staticClass:"mdui-typo-body-2 mdui-m-b-1 no-sl"},[e._v(e._s(e.$t("depot.result.tip")))]),r("div",{staticClass:"result"},[r("div",{ref:"resultScrollable",staticClass:"result-scrollable",style:{"overflow-x":e.isDrProcessing?"hidden":""},on:{dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),function(t){return e.useImg(t.dataTransfer.files[0])}(t)},contextmenu:function(e){e.preventDefault()},wheel:e.onScrollResult}},[r("div",{staticClass:"result-wrapper",style:e.resultWrapperStyle},[r("div",{staticClass:"result-container",style:{backgroundImage:"url("+(e.drImg.src||e.PNG1P)+")",paddingBottom:100/e.drImgRatio+"%"}},[e._l(e.drData,(function(t,n){var a=t.view,i=t.sim,s=t.num;return[i&&s&&(i.diff<=e.MAX_SHOW_DIFF||e.isTrustedResult(i))?r("div",{key:n,staticClass:"result-square pointer",class:{disabled:!e.drSelect[n]},style:e.viewNumToPct(a),on:{click:function(t){return t.target!==t.currentTarget?null:e.$set(e.drSelect,n,!e.drSelect[n])},contextmenu:function(t){return t.preventDefault(),e.editResult(n)}}},[r("div",{staticClass:"result-sim mdui-valign",class:{"mdui-ripple mdui-ripple-white":e.drSelect[n]},on:{click:function(t){return e.editResult(n)}}},[r("arkn-item",{staticClass:"result-sim-img",staticStyle:{height:"100%"},attrs:{t:e.materialTable[i.name].rare,img:i.name,width:""}}),r("div",{staticClass:"result-sim-num no-pe no-sl"},[e._v(e._s(s.value))])],1),s.warn&&!s.edit?r("div",{staticClass:"result-sim-warn no-sl no-pe"},[e._v("⚠️")]):e._e()]):e._e()]}))],2)]),r("div",{directives:[{name:"show",rawName:"v-show",value:e.$_.size(e.drData),expression:"$_.size(drData)"}],staticClass:"debug-checkbox-wrapper"},[r("mdui-checkbox",{staticClass:"debug-checkbox",model:{value:e.debug,callback:function(t){e.debug=t},expression:"debug"}},[e._v("Debug")])],1),r("div",{directives:[{name:"show",rawName:"v-show",value:e.isDrProcessing,expression:"isDrProcessing"}],staticClass:"result-progress"},[r("mdui-spinner",{staticClass:"mdui-m-r-1",attrs:{colorful:!0}}),r("div",{staticClass:"mdui-typo-body-1 mdui-text-color-black-text"},[e._v(e._s(e.$t("depot.recognitionSteps."+e.drStep)))])],1)])]),e.drData?r("div",{staticClass:"mdui-row mdui-m-t-2"},[r("div",{staticClass:"mdui-col-xs-6"},[r("label",{directives:[{name:"theme-class",rawName:"v-theme-class",value:["mdui-color-purple","mdui-color-purple-a100 mdui-ripple-black"],expression:"['mdui-color-purple', 'mdui-color-purple-a100 mdui-ripple-black']"}],staticClass:"mdui-btn mdui-btn-raised mdui-ripple mdui-btn-block",attrs:{for:"img-select"},on:{dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),function(t){return e.useImg(t.dataTransfer.files[0])}(t)}}},[e._v(e._s(e.$t("depot.result.selectImage")))])]),r("div",{staticClass:"mdui-col-xs-6"},[r("button",{directives:[{name:"theme-class",rawName:"v-theme-class",value:e.$root.color.pinkBtn,expression:"$root.color.pinkBtn"}],staticClass:"mdui-btn mdui-btn-raised mdui-ripple mdui-btn-block",attrs:{disabled:!e.drData.length},on:{click:e.importItems}},[e._v(e._s(e.$t("common.import")))])])]):e._e()]:r("label",{staticClass:"image-select pointer mdui-valign mdui-text-center mdui-p-a-4 no-sl",attrs:{for:"img-select"},on:{dragover:function(e){e.preventDefault()},drop:function(t){return t.preventDefault(),function(t){return e.useImg(t.dataTransfer.files[0])}(t)}}},[r("div",{staticClass:"mdui-typo-display-1-opacity mdui-hidden-xs",domProps:{innerHTML:e._s(e.$t("depot.input.title"))}}),r("div",{staticClass:"mdui-typo-headline mdui-hidden-sm-up",staticStyle:{opacity:"0.54"},domProps:{innerHTML:e._s(e.$t("depot.input.title"))}})]),r("input",{ref:"image",staticStyle:{display:"none"},attrs:{type:"file",id:"img-select",accept:"image/jpeg,image/png"},on:{change:function(t){return e.useImg(e.$refs.image.files[0])}}}),e.debug&&e.drData?r("div",{staticClass:"mdui-m-t-4 no-sl",attrs:{id:"debug"}},[e._l(e.drData,(function(t,n){var a=t.sim,i=t.num,s=t.pos,u=s.x,c=s.y,o=t.debug.scale;return[i?r("div",{key:n,staticClass:"debug-item mdui-m-b-2"},[r("div",{staticClass:"debug-img",style:{backgroundImage:"url("+(e.drImg.src||e.PNG1P)+")",backgroundPosition:"-"+u*o+"px -"+c*o+"px",backgroundSize:"auto "+e.drImg.h*o+"px"}}),r("img",{staticClass:"debug-num-img no-pe mdui-m-r-1",attrs:{src:i.img}}),r("pre",{staticClass:"mdui-m-y-0"},[e._v("item: "+e._s(a.name)+"\nsimi: "+e._s(e.$_.round(100*(1-a.diff),2))+"%\ntext: "+e._s(i.text))])]):e._e()]}))],2):e._e(),e._l(e.drDebug,(function(e,t){return r("img",{key:t,staticClass:"test-img mdui-m-t-2",attrs:{src:e}})}))],2)},a=[],i=r("b85c"),s=r("5530"),u=r("1da1"),c=(r("96cf"),r("d81d"),r("4de4"),r("b0c0"),r("caad"),r("2b3d"),r("d3b7"),r("3ca3"),r("ddb0"),r("498a"),r("2ca0"),r("99af"),r("1276"),r("ac1f"),r("8679")),o=r("60bb"),d=r.n(o),l=r("60fe"),m=r("f71e"),p=r("29d9"),f=r("989f"),b=r("262e"),g=r.n(b),v=r("2fa1"),h=r("3dc1"),w=r("7e19"),x=r.n(w);new p["a"]("dr.pkg").clear();var k=null,y=function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!k){e.next=2;break}return e.abrupt("return",k);case 2:return t=new g.a,e.next=5,fetch(x.a).then((function(e){return e.arrayBuffer()}));case 5:return r=e.sent,e.next=8,new t.DeportRecognizer(Object(v["transfer"])({order:h,pkg:r},[r]));case 8:return k=e.sent,e.abrupt("return",k);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=r("de76"),D=new p["a"]("depot"),_={name:"arkn-depot",components:{ArknItem:c["a"]},data:function(){return{MAX_SHOW_DIFF:f["a"],PNG1P:l["c"],materialTable:I["b"],drImg:{src:null,w:0,h:0},drData:null,drSelect:[],drStep:"",drDebug:[],debug:!1}},computed:{itemsWillBeImported:function(){var e=this;return d.a.fromPairs(this.drData.filter((function(t,r){var n=t.sim,a=t.num;return n&&a&&e.drSelect[r]})).map((function(e){var t=e.sim.name,r=e.num.value;return[t,r]})))},drImgRatio:function(){return this.drImg.w/this.drImg.h||0},resultWrapperStyle:function(){var e=this.drImgRatio;return!e||e>4/3?{minWidth:"1000px"}:window.innerWidth>window.innerHeight?{width:"".concat(70*e,"vh"),margin:"auto"}:{}},isDrProcessing:function(){return this.drStep>=0}},methods:{isTrustedResult:f["b"],viewNumToPct:function(e){return d.a.mapValues(e,(function(e){return"".concat(d.a.round(100*e,3),"%")}))},updateStep:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.drStep=e},useImg:function(e){var t=this;return Object(u["a"])(regeneratorRuntime.mark((function r(){var n,a,i,s;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e&&["image/jpeg","image/png"].includes(e.type)){r.next=2;break}return r.abrupt("return");case 2:return t.drImg.src&&URL.revokeObjectURL(t.drImg.src),t.updateStep(0),t.drData=null,t.drSelect=[],t.drDebug=[],t.drImg={src:URL.createObjectURL(e),w:0,h:0},t.updateImgInfo(),t.$gtag.event("depot_recognition",{event_category:"depot",event_label:"recognition"}),r.next=12,y();case 12:return n=r.sent,r.next=15,n.setDebug(t.debug);case 15:return r.next=17,n.recognize(t.drImg.src,Object(v["proxy"])(t.updateStep));case 17:a=r.sent,i=a.data,s=a.debug,console.log("Recognition",Object(f["c"])(i),i),t.drData=d.a.cloneDeep(i),t.drSelect=i.map(f["b"]),t.drDebug=s,setTimeout(t.updateStep);case 25:case"end":return r.stop()}}),r)})))()},updateImgInfo:function(){var e=this,t=new Image;t.src=this.drImg.src,t.onload=function(){e.drImg.w=t.width,e.drImg.h=t.height}},editResult:function(e){var t=this;this.$prompt("材料数量","修改结果",(function(r){var n=r.trim();/^[0-9]+$/.test(n)?(t.drData[e].num.value=parseInt(n),t.$set(t.drData[e].num,"edit",!0)):t.editResult(e)}),(function(){}),{history:!1,confirmOnEnter:!0,cancelText:this.$t("common.cancel"),confirmText:this.$t("common.edit"),defaultValue:this.drData[e].num.value})},importItems:function(){if(this.$root.importItemsListening)this.$root.$emit("import-items",this.itemsWillBeImported);else{var e=Object(s["a"])(Object(s["a"])({},D.getItem("imports")||{}),this.itemsWillBeImported);D.setItem("imports",e)}this.$snackbar(this.$t("depot.result.imported"))},detectPasteAndUseImg:function(e){if(this.$route.path.startsWith("/depot")&&m["a"](e))return m["b"]().then(this.useImg)},readClipboardImg:function(){var e=this;return Object(u["a"])(regeneratorRuntime.mark((function t(){var r,n,a,s,u,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$requestClipboardPermission("clipboard-read");case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,navigator.clipboard.read();case 6:r=t.sent,n=Object(i["a"])(r),t.prev=8,n.s();case 10:if((a=n.n()).done){t.next=20;break}if(s=a.value,u=s.types.filter((function(e){return e.startsWith("image/")})),!(u.length>0)){t.next=18;break}return t.next=16,s.getType(u[0]);case 16:return c=t.sent,t.abrupt("return",new File([c],"depot-".concat(Date.now(),".").concat(d.a.last(u[0].split("/"))),{type:u[0]}));case 18:t.next=10;break;case 20:t.next=25;break;case 22:t.prev=22,t.t0=t["catch"](8),n.e(t.t0);case 25:return t.prev=25,n.f(),t.finish(25);case 28:case"end":return t.stop()}}),t,null,[[8,22,25,28]])})))()},onScrollResult:function(e){var t=this.$refs.resultScrollable;e.deltaY&&t.scrollWidth>t.clientWidth&&(e.preventDefault(),t.scrollLeft+=e.deltaY)}},created:function(){this.$$(window).on("keydown",this.detectPasteAndUseImg),this.debug=!!this.$route.query.debug},beforeDestroy:function(){this.$$(window).off("keydown",this.detectPasteAndUseImg)}},C=_,$=(r("db2a"),r("0c7c")),S=Object($["a"])(C,n,a,!1,null,null,null);t["default"]=S.exports},db2a:function(e,t,r){"use strict";r("00d5")},de76:function(e,t,r){"use strict";r.d(t,"b",(function(){return u}));var n=r("5530"),a=(r("07ac"),r("d81d"),r("b0c0"),r("5db7"),r("73d9"),r("60bb")),i=r.n(a),s=r("9d72"),u=i.a.mapValues(s,(function(e,t){return Object(n["a"])({name:t},e)})),c=i.a.sortBy(Object.values(u),"sortId"),o=i.a.groupBy(c,(function(e){var t=e.rare;return t})),d=c.map((function(e){var t=e.name;return t})),l=i.a.flatMap(Object.values(o).reverse(),(function(e){return e.map((function(e){var t=e.name;return t}))}));t["a"]={materials:o,materialTable:u,materialList:c,materialOrder:d,materialRareFirstOrder:l}},f71e:function(e,t,r){"use strict";r.d(t,"c",(function(){return l})),r.d(t,"a",(function(){return m})),r.d(t,"b",(function(){return p}));var n=r("b85c"),a=r("1da1"),i=(r("2ca0"),r("b0c0"),r("4de4"),r("99af"),r("1276"),r("ac1f"),r("96cf"),r("60bb")),s=r.n(i),u=r("0868"),c=r("9225"),o=function(){return Object(u["a"])({message:c["a"].t.apply(c["a"],arguments),timeout:6e3})},d=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,navigator&&"permissions"in navigator&&"clipboard"in navigator){e.next=4;break}return o("common.clipboard.notSupport",{name:t}),e.abrupt("return",!1);case 4:return e.next=6,navigator.permissions.query({name:t});case 6:if(r=e.sent.state,"granted"===r||"prompt"===r){e.next=10;break}return o("common.clipboard.permissionDenied",{name:t}),e.abrupt("return",!1);case 10:e.next=17;break;case 12:return e.prev=12,e.t0=e["catch"](0),console.error(e.t0),o("common.clipboard.notSupport",{name:t}),e.abrupt("return",!1);case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d("clipboard-write");case 2:if(!e.sent){e.next=13;break}return e.prev=3,e.next=6,navigator.clipboard.writeText(t);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](3),console.error(e.t0),o("common.clipboard.writeFailed");case 12:return e.abrupt("return",!0);case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t){return e.apply(this,arguments)}}(),m=function(e){var t,r,n=e.ctrlKey,a=e.metaKey,i=e.keyCode;return 86===i&&!!(n||null!==(t=navigator)&&void 0!==t&&null!==(r=t.platform)&&void 0!==r&&r.startsWith("Mac")&&a)},p=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(){var t,r,a,i,u,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d("clipboard-read");case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,navigator.clipboard.read().catch((function(e){return console.error(e),"DataError"===e.name?o("common.clipboard.readDataError"):o("common.clipboard.readFailed"),[]}));case 6:t=e.sent,r=Object(n["a"])(t),e.prev=8,r.s();case 10:if((a=r.n()).done){e.next=20;break}if(i=a.value,u=i.types.filter((function(e){return e.startsWith("image/")})),!(u.length>0)){e.next=18;break}return e.next=16,i.getType(u[0]);case 16:return c=e.sent,e.abrupt("return",new File([c],"clipboard-".concat(Date.now(),".").concat(s.a.last(u[0].split("/"))),{type:u[0]}));case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](8),r.e(e.t0);case 25:return e.prev=25,r.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[8,22,25,28]])})));return function(){return e.apply(this,arguments)}}()}}]);